{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- bootstrap 5 -->
    <link rel="stylesheet" href="{% static 'inscription/assets/css/Bootstrap/bootstrap.min.css' %}">
    <!-- Custom Css Files -->
    <link rel="stylesheet" href="{% static 'inscription/assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'inscription/assets/css/grade_btns.css' %}">
    <title>Inscription</title>
</head>
<body>

    <!-- bar -->
    <div class="step-bar-P3">
        <div class="bar">
            <div class="w-100 fill"></div>
        </div>
        <div class="bar">
            <div class="fill w-100"></div>
        </div>
        <div class="bar">
            <div class="fill w-100 "></div>
        </div>
    </div>

    <section class="vh-100 gradient-custom">
        <div class="container py-5 h-100">
          <div class="row justify-content-center align-items-center h-100">
            <div class="col-12 col-lg-9 col-xl-7">
              <div class="card shadow-2-strong card-registration" 
              style="background: rgba(255, 255, 255, 0.76);
              border-radius: 16px;
              box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
              backdrop-filter: blur(18.9px);
              -webkit-backdrop-filter: blur(18.9px);
              border: 1px solid rgba(255, 255, 255, 0.3);">

                <div class="card-body p-4 p-md-5">
                  <h3 class="mb-4 pb-2 pb-md-0 mb-md-5"><strong>Select Your Grade :</strong></h3>
                          <video id="video" width="640" height="640" autoplay></video>
                          <a class="btn-3" href="#" id="save-button">Save Your Face</a>

                          <canvas id="canvas" width="640" height="480"></canvas>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
        
      </section>
      <script>
        const captureButton = document.querySelector('#capture-button');
        const saveButton = document.querySelector('#save-button');
        const video = document.querySelector('#video');
        const canvas = document.querySelector('#canvas');
        

        function startVideo() {
            canvas.style.display = "none";
            const video = document.getElementById('video');
            navigator.mediaDevices.getUserMedia({ video: true })
              .then(stream => {
                video.srcObject = stream;
                video.play();
              })
              .catch(error => {
                console.error('Error accessing video camera:', error);
              });
          }

        window.addEventListener('load', startVideo);
  
        saveButton.addEventListener('click', () => {
          const context = canvas.getContext('2d');
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
  
          const capturedImage = canvas.toDataURL('image/jpeg');
          canvas.style.display = "none";
  
          saveImage(capturedImage);
        });
  
        async function saveImage(imageData) {
          const response = await fetch('/save-image/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ foo : imageData }),
          });
  
          const result = await response.json();
          console.log(result);

          if (result.success) {
            window.location.href = '/avatar/';
          } else {
            window.location.href = '/signup/';
          }
        }
      </script>





      

</body>
</html>


{% endblock %}